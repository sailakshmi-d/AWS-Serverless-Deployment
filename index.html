<!DOCTYPE html> 
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Serverless E-Commerce Store</title>
  <style>
    body { font-family: Arial, sans-serif; margin: 0; padding: 20px; }
    header { background: #333; color: #fff; padding: 10px 20px; text-align: center; }
    .product-list { display: flex; flex-wrap: wrap; gap: 20px; padding: 20px; }
    .product { border: 1px solid #ccc; border-radius: 8px; padding: 10px; width: 200px; text-align: center; }
    .product img { max-width: 100%; border-radius: 5px; }
    .product button { background: #28a745; color: white; padding: 8px 12px; border: none; border-radius: 4px; cursor: pointer; }
    .cart { position: fixed; top: 20px; right: 20px; background: #007bff; color: white; padding: 10px; border-radius: 5px; }
    .order-btn { margin-top: 10px; padding: 10px 15px; background: #ff5722; color: white; border: none; border-radius: 5px; cursor: pointer; }
  </style>
</head>
<body>
  <header>
    <h1>My Serverless E-Commerce Store</h1>
  </header>

  <div class="cart" id="cart">Cart: 0 items</div>

  <div class="product-list" id="productList"></div>

  <button class="order-btn" onclick="placeOrder()" id="orderBtn" disabled>Place Order</button>

  <script>
    const API_BASE_URL = 'https://eshm3ik4b0.execute-api.us-east-1.amazonaws.com/dev';  // Replace with your API  
    let cart = {};

    async function fetchProducts() {
      try {
        const res = await fetch(`${API_BASE_URL}/products`);
        const products = await res.json();

        const productList = document.getElementById('productList');
        productList.innerHTML = '';

        products.forEach(product => {
          const div = document.createElement('div');
          div.className = 'product';
          div.innerHTML = `
            <img src="${product.imageUrl}" alt="${product.name}" />
            <h3>${product.name}</h3>
            <p>$${product.price.toFixed(2)}</p>
            <button onclick="addToCart('${product.productId}', '${product.name}', ${product.price})">Add to Cart</button>
          `;
          productList.appendChild(div);
        });
      } catch (err) {
        console.error('Error fetching products:', err);
      }
    }

    function updateCartUI() {
      const cartCount = Object.values(cart).reduce((a,b) => a+b, 0);
      document.getElementById('cart').textContent = `Cart: ${cartCount} item${cartCount !== 1 ? 's' : ''}`;
      document.getElementById('orderBtn').disabled = cartCount === 0;
    }

    function addToCart(id, name, price) {
      if (cart[id]) {
        cart[id]++;
      } else {
        cart[id] = 1;
      }
      updateCartUI();
    }

    async function placeOrder() {
      if (Object.keys(cart).length === 0) {
        alert('Cart is empty!');
        return;
      }

      const orderItems = Object.entries(cart).map(([productId, quantity]) => ({ productId, quantity }));

      try {
        const res = await fetch(`${API_BASE_URL}/orders`, {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ items: orderItems }),
        });
        const data = await res.json();

        if (res.ok) {
          alert(`Order placed successfully! Order ID: ${data.orderId}`);
          cart = {};
          updateCartUI();
        } else {
          alert('Error placing order: ' + (data.message || 'Unknown error'));
        }
      } catch (err) {
        alert('Error placing order: ' + err.message);
      }
    }

    fetchProducts();
    updateCartUI();
  </script>
</body>
</html>

